# mqttDataKeeper

Маленький скрипт, который сохраняет в БД MongoDB все, что приходит на заданные MQTT-топики. 

Если MongoDB по какой-то причине недоступна, данные будут сохраняться в NeDB. После восстановления связи с Mongo, все сохраненные в NeDB данные перенесутся туда.

```
"router": [{...}, {...}, ...]

{
	"topic": "myHome/temp/indoor",  // Топик на который приходят сообщения
	"collection": "temperature",    // Коллекция в которую их сохраняем
	"type": "float",                // Тип данных (не обязательный параметр - если не указан, определяется автоматически)
	"name": "indoor",               // Имя параметра в БД
	"accuracy": 0.2,                // Погрешность измерений, в пределах которой данные не заносятся в БД
	"interval": 60                  // Промежуток времени (в секундах), через который, поступившие данные заносятся в БД, даже если они все еще находятся в пределах погрешности (такой своего рода "keep alive")
}
```

*При задании параметера `interval` нужно учитывать, что если `accuracy` также задан, то поступающие значения будут сохраняться не реже заданного промежутка времени. А если параметр `accuracy` не задан, то значения будут сохраняться не чаще этого промежутка времени.*

### Примечания к выпускам

*1.0.2*
- Добавлено описание программы
- Добавлен новый параметр `interval` в массив маршрутизации сообщений
- Добавлена возможность указывать дополнительные параметры для подключения к MQTT-брокеру

*1.0.1*
- Каталог NeDB теперь автоматически создается (если не существует)

### TODO

- Возможность использовать шаблоны в маршрутах
